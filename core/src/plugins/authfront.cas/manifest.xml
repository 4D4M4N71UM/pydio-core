<?xml version="1.0" encoding="UTF-8"?>
<ajxpcore id="authfront.cas" enabled="false" label="CONF_MESSAGE[CAS FrontEnd]" description="CONF_MESSAGE[Authentication by CAS]" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:../core.ajaxplorer/ajxp_registry.xsd">
	<class_definition filename="plugins/authfront.cas/class.CasAuthFrontend.php" classname="CasAuthFrontend"/>
    <server_settings>
        <global_param name="ORDER" type="integer" label="Order" description="Order this plugin with other auth frontends" default="11" mandatory="true"/>
        <global_param name="CREATE_USER" type="boolean" label="Create User"
                      description="Automatically create user if it does not already exists" default="true"/>
        <global_param name="FORCE_REDIRECT" type="boolean" label="Force redirect"
                      description="Redirect to CAS server for authentication. Otherwise, bypass this and use another following authfront" default="false"/>
        <global_param name="PROTOCOL_TYPE" type="select"
                      choices="session_only|Sessions Only"
                      label="Protocol Type" description="Enable/disable automatically based on the protocol used" default="session_only"/>
        <global_param name="CAS_SERVER" type="string" label="CONF_MESSAGE[CAS Server]" description="CONF_MESSAGE[CAS server address]" mandatory="true" />
        <global_param name="CAS_PORT" type="integer" label="CONF_MESSAGE[CAS Port]" description="CONF_MESSAGE[Port where CAS server is running on]" mandatory="true" />
        <global_param name="CAS_URI" type="string" label="CONF_MESSAGE[CAS URI]" description="CONF_MESSAGE[URI for CAS service]" mandatory="true" />
        <global_param name="LOGOUT_URL" type="string" label="CONF_MESSAGE[Logout URL]" description="CONF_MESSAGE[Redirect to the given URL on loggin out]" mandatory="true" />
    </server_settings>

    <registry_contributions>
        <external_file filename="plugins/core.auth/standard_auth_actions.xml" include="actions/*" exclude="actions/action[@name='logoutCAS']"/>
        <actions>
            <action name="logoutCAS" expireDefault="true">
                <gui text="164" title="169" src="logoutCAS.png" accessKey="" hasAccessKey="false">
                    <context selection="false" dir="" recycle="false" actionBar="true" contextMenu="false" infoPanel="false" actionBarGroup="user" ajxpWidgets="UserWidget::logging_string"></context>
                </gui>
                <rightsContext noUser="false" userLogged="only" guestLogged="show" read="false" write="false" adminOnly=""></rightsContext>
                <processing>
                        <clientCallback prepareModal="false"><![CDATA[
                  clearRememberData();
                  var connexion = new Connexion();
                  connexion.addParameter('get_action', 'logoutCAS');
                  connexion.onComplete = function(transport)
                  {
                    var child = transport.responseXML.documentElement.childNodes;
                    try
                    {
                      document.location.href = child[0].nodeValue;
                    }
                    catch(e){}
                  };
                  connexion.sendAsync();
                   ]]></clientCallback>

                    <serverCallback methodName="logOutCAS"></serverCallback>
                </processing>
            </action>
        </actions>

    </registry_contributions>

</ajxpcore>
